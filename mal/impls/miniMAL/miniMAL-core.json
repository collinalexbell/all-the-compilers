["do",

["def", "new", ["fn", ["a", "&", "b"],
  [".", "Reflect", ["`", "construct"], "a", "b"]]],
["def", "del", ["fn", ["a", "b"],
  [".", "Reflect", ["`", "deleteProperty"], "a", "b"]]],
["def", "map", ["fn", ["a", "b"],
  [".", "b", ["`", "map"], ["fn", ["x"], ["a", "x"]]]]],
["def", "list", ["fn", ["&", "a"], "a"]],
["def", ">=", ["fn", ["a", "b"],
  ["if", ["<", "a", "b"], false, true]]],
["def", ">", ["fn", ["a", "b"],
  ["if", [">=", "a", "b"],
    ["if", ["=", "a", "b"], false, true],
    false]]],
["def", "<=", ["fn", ["a", "b"],
  ["if", [">", "a", "b"], false, true]]],

["def", "classOf", ["fn", ["a"],
  [".", [".-", [".-", "Object", ["`", "prototype"]], ["`", "toString"]],
        ["`", "call"], "a"]]],

["def", "not", ["fn", ["a"], ["if", "a", false, true]]],

["def", "null?", ["fn", ["a"], ["=", null, "a"]]],
["def", "true?", ["fn", ["a"], ["=", true, "a"]]],
["def", "false?", ["fn", ["a"], ["=", false, "a"]]],
["def", "string?", ["fn", ["a"],
  ["if", ["=", "a", null],
    false,
    ["=", ["`", "String"],
          [".-", [".-", "a", ["`", "constructor"]],
                 ["`", "name"]]]]]],
["def", "number?", ["fn", ["a"],
  ["=", ["`", "[object Number]"], ["classOf", "a"]]]],
["def", "function?", ["fn", ["a"],
  ["isa", "a", "Function"]]],

["def", "pr-list*", ["fn", ["a", "b", "c"],
  [".", ["map", ["fn", ["x"],
                  ["if", "c",
                    [".", "JSON", ["`", "stringify"], "x"],
                    ["if", ["string?", "x"],
                      "x",
                      [".", "JSON", ["`", "stringify"], "x"]]]],
              "a"],
      ["`", "join"], "b"]]],
["def", "pr-str", ["fn", ["&", "a"],
  ["pr-list*", "a", ["`", " "], true]]],
["def", "str", ["fn", ["&", "a"],
  ["pr-list*", "a", ["`", ""], false]]],
["def", "prn", ["fn", ["&", "a"],
  ["do", [".", "console", ["`", "log"],
           ["pr-list*", "a", ["`", " "], true]], null]]],
["def", "println", ["fn", ["&", "a"],
  ["do", [".", "console", ["`", "log"],
           ["pr-list*", "a", ["`", " "], false]], null]]],

["def", "list?", ["fn", ["a"],
  [".", "Array", ["`", "isArray"], "a"]]],
["def", "contains?", ["fn", ["a", "b"],
  [".", "a", ["`", "hasOwnProperty"], "b"]]],
["def", "get", ["fn", ["a", "b"],
    ["if", ["contains?", "a", "b"], [".-", "a", "b"], null]]],
["def", "set", ["fn", ["a", "b", "c"],
  ["do", [".-", "a", "b", "c"], "a"]]],
["def", "keys", ["fn", ["a"],
  [".", "Object", ["`", "keys"], "a"]]],
["def", "vals", ["fn", ["a"],
  ["map",["fn", ["k"], ["get", "a", "k"]], ["keys", "a"]]]],

["def", "cons", ["fn", ["a", "b"],
  [".", ["`", []],
        ["`", "concat"], ["list", "a"], "b"]]],
["def", "concat", ["fn", ["&", "a"],
  [".", [".-", ["list"], ["`", "concat"]],
        ["`", "apply"], ["list"], "a"]]],
["def", "nth", "get"],
["def", "first", ["fn", ["a"],
  ["if", [">", [".-", "a", ["`", "length"]], 0],
    ["nth", "a", 0],
    null]]],
["def", "last", ["fn", ["a"],
  ["nth", "a", ["-", [".-", "a", ["`", "length"]], 1]]]],
["def", "count", ["fn", ["a"],
  [".-", "a", ["`", "length"]]]],
["def", "empty?", ["fn", ["a"],
  ["if", ["list?", "a"],
    ["if", ["=", 0, [".-", "a", ["`", "length"]]], true, false],
    ["=", "a", null]]]],
["def", "slice", ["fn", ["a", "b", "&", "end"],
  [".", "a", ["`", "slice"], "b",
    ["if", [">", ["count", "end"], 0],
      ["get", "end", 0],
      [".-", "a", ["`", "length"]]]]]],
["def", "rest", ["fn", ["a"], ["slice", "a", 1]]],

["def", "apply", ["fn", ["f", "&", "b"],
  [".", "f", ["`", "apply"], "f",
    ["concat", ["slice", "b", 0, -1], ["last", "b"]]]]],

["def", "and", ["~", ["fn", ["&", "xs"],
  ["if", ["empty?", "xs"],
    true,
    ["if", ["=", 1, ["count", "xs"]],
      ["first", "xs"],
      ["list", ["`", "let"], ["list", ["`", "and_FIXME"], ["first", "xs"]],
        ["list", ["`", "if"], ["`", "and_FIXME"],
          ["concat", ["`", ["and"]], ["rest", "xs"]],
          ["`", "and_FIXME"]]]]]]]],

["def", "or", ["~", ["fn", ["&", "xs"],
  ["if", ["empty?", "xs"],
    null,
    ["if", ["=", 1, ["count", "xs"]],
      ["first", "xs"],
      ["list", ["`", "let"], ["list", ["`", "or_FIXME"], ["first", "xs"]],
        ["list", ["`", "if"], ["`", "or_FIXME"],
          ["`", "or_FIXME"],
          ["concat", ["`", ["or"]], ["rest", "xs"]]]]]]]]],

["def", "repl", ["fn",["prompt", "rep"],
  ["let", ["readline", ["require", ["`", "readline"]],
           "opts", ["new", "Object"],
           "_", ["set", "opts", ["`", "input"], [".-", "process", ["`", "stdin"]]],
           "_", ["set", "opts", ["`", "output"], [".-", "process", ["`", "stdout"]]],
           "_", ["set", "opts", ["`", "terminal"], false],
           "rl", [".", "readline", ["`", "createInterface"], "opts"],
           "evl", ["fn", ["line"],
                    ["do",
                      ["println", ["rep", "line"]],
                      [".", "rl", ["`", "prompt"]]]]],
    ["do",
      [".", "rl", ["`", "setPrompt"], "prompt"],
      [".", "rl", ["`", "prompt"]],
      [".", "rl", ["`", "on"], ["`", "line"], "evl"]]]]],

null
]

